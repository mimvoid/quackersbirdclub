{{/* Builds the Sass files into CSS and links them. */ -}}

{{- $isProduction := hugo.IsProduction }}
{{- $opts := dict
    "transpiler" "dartsass"
    "outputStyle" (cond $isProduction "compressed" "nested")
    "enableSourceMap" (not $isProduction)
}}

{{- $sources := slice "scss/style.scss" -}}
{{- if .Page.IsHome }}
  {{ $sources = $sources | append "scss/pages/_home.scss" }}
{{ end -}}

{{- range $sources }}
  {{ $css := resources.Get . | toCSS $opts }}
  {{ with $css | cond $isProduction (fingerprint $css) }}
    <link
      rel="stylesheet"
      href="{{ .RelPermalink }}"
      {{ if $isProduction }} integrity="{{ .Data.Integrity }}"{{ end }}
      media="all"
    >
  {{ end }}
{{ end }}
